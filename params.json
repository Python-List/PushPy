{"name":"Pushpy","tagline":"Apple Push notification server with DB and Web interface implemented in Python","body":"[![Foo](http://img407.imageshack.us/img407/8403/logoasaf.jpg)](http://google.com.au/)\r\n\r\n# Pushpy 1.0\r\n\r\nPushpy is a push notification server based on Python. It's composed by a users database to store users token ( and more information that the server owner wants ), a web interface with Google Login to send notifications using a web platform. The Google emails accounts allowed to send notifications are stored in another database\r\n\r\n## Technologies\r\n* **Flask Microframework**: The Python Framework used to the web user interface.\r\n* **Python**: For the entire backend. Is a general-purpose, high-level programming language whose design philosophy emphasizes code readability.\r\n* **Flask-WTF**:Flask-WTF offers simple integration with WTForms. This integration includes optional CSRF handling for greater security.\r\n* **Flask-Logins**:Flask-Login provides user session management for Flask. It handles the common tasks of logging in, logging out, and remembering your usersâ€™ sessions over extended periods of time.\r\n\r\n## Prerequisites\r\nEnsure evereything bellow is installed. Otherwise PushPy won't work propertly.\r\n\r\n* Python\r\n* MySQL or SQLite\r\n* Flask:\r\n> \tpip install Flask\r\n* Flask-WTF:\r\n>\tpip install Flask-WTF\r\n* Flask-Login\r\n>\tpip install flask-login\r\n* Flask-OpenID\r\n>\tpip install flask-openid\r\n* Flask-SQLAlchemy\r\n>\tpip install flask-sqlalchemy\r\n* Flask-Admin\r\n>\tpip install flask-admin\r\n\r\n## Setup\r\nInside /app folder you'll finde a file called config.py .  This file contains all configuration of Pushpy. The parameters you have to setup are:\r\n\r\nRelated with DB configuration:\r\n> dbname= 'pushpy'\r\n> \r\n> DB_URI= 'sqlite:///'+ dbname + '.db'\r\n\r\nWhere you introduce your dbname and DB_URI has the URI to connect database\r\n\r\n**Note: In case you use MySQL remember to create database and specify its name in dbname**\r\n\r\nThen you have to config **CSFR_ENABLED** and **SECRET_KEY**. Both parameters are related with Flask-WTF. You'll find information about them here: [http://pythonhosted.org/Flask-WTF/](http://)\r\n> CSRF_ENABLED = True\r\n> \r\n> SECRET_KEY = ''\r\n> \r\n> basedir = os.path.abspath(os.path.dirname(__file__))\r\n> \r\n> OPENID_PROVIDERS = [\r\n>     { 'name': 'Google', 'url': 'https://www.google.com/accounts/o8/id' }]\r\n\r\nThe last one OPENID_PROVIDERS has all providers allowed for openID login. Pushpy is designed to works with Google accounts but take a look at OpenID, you can add more openID providers. [http://openid.net/get-an-openid/](http://)\r\n\r\n####Allowed users\r\n\r\nIn the lines bellow you must config the users that have permissions to send notifications. You only have o introduce their nickname and their email.\r\n\r\n>  Allowed users to send notifications ( using gmail accounts )\r\n\r\n> adminusers=[{'nickname':'nick1','email':'user@gmail.com'},\r\n            ]\r\n\r\n### Generate push certificate\r\nFor sending notifications you need a certificated generated by the App Dev Center. If you don't know how to generate it please follow this tutorial:\r\n\r\n[https://code.google.com/p/apns-php/wiki/CertificateCreation](http://)\r\n\r\nI called both dev.pem and dist.pem ( development and production certificates ). Please, put both in root PushPy folder\r\n\r\n**Depending if you are sending notifications in development or distribution mode you have to select it in web interface. Take care if you have many users in your database cause they could received not expected notifications.**\r\n\r\n\r\n## Run\r\nIf everything is ok run server:\r\n> python server.py\r\n\r\nThen enter to the url bellow and a Login page will appear. Login with your Google account and if it's on the database as allowed you'll enter to the Send Notifications page.\r\n\r\n[http://127.0.0.1:5000/pushpy/push\r\n](http://)\r\n\r\nThe rest is explained in the page\r\n\r\n[![Foo](http://img43.imageshack.us/img43/3857/capturadepantalla201303n.png)](http://google.com.au/)\r\n\r\n\r\n## iOS App\r\nThe last thing is setup iOS client app to update users information in database. We have added a Obj-c class to simplify the proccess. Everything you have to do is firstly register you app for push notifications.\r\n\r\nAdd this line in your **- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions**\r\n\r\n `[[UIApplication sharedApplication] registerForRemoteNotificationTypes: (UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeSound | UIRemoteNotificationTypeAlert)];`\r\n\r\nMoreover config PPy ios library with this lines just under bellow:\r\n`[[PPyController sharedPPy] initializeWithAddress:@\"mydomain.com\" andPort:@\"5000\"]`\r\n\r\n**Important: You have to change mydomain.com and 5000 for your domain and your port where Pushpy server si being executed**\r\n\r\nThen we have to register the user as soon as a token from Apple APN server is received. Put this code fragment in your App Delegate:\r\n\r\n`- (void)application:(UIApplication*)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData*)deviceToken\r\n{\r\n\r\n\tNSLog(@\"My token is: %@\", deviceToken);\r\n\tNSString* devicetoken = [[[[token description] stringByReplacingOccurrencesOfString: @\"<\" withString: @\"\"] stringByReplacingOccurrencesOfString: @\">\" withString: @\"\"] stringByReplacingOccurrencesOfString: @\" \" withString: @\"\"] ;                                  \r\n    BOOL enabled=TRUE; //It's depend on your app user configuration\r\n    NSString * language = [[NSLocale preferredLanguages] objectAtIndex:0];\r\n    NSDictionary\r\n    NSDictionary *dict=[[NSDictionary alloc] initWithObjectsAndKeys:devicetoken,@\"token\",language,@\"language\",[NSNumber numberWithBool:enabled],@\"enabled\", nil];\r\n                               \r\n}`\r\n\r\n**Note: if erverything is correct you should receive a message from log alerting the data was updated in server. Otherwise take a repeat the last steps**\r\n\r\n*SecureUDID: is the library used by PPy to generate a private UDID for the user. You'll find more information [here](http://www.secureudid.org/)*\r\n\r\nIf you want to show the received notifications in the app you only have to implement the following method of your app delegate:\r\n\r\n`-(void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo{\r\n\r\n    NSLog(@\"Notification received\");\r\n    NSDictionary *apsInfo = [userInfo objectForKey:@\"aps\"];\r\n    UIAlertView *alertView=[[UIAlertView alloc] initWithTitle:@\"Notification\" message:[apsInfo objectForKey:@\"alert\"] delegate:self cancelButtonTitle:@\"Cancel\" otherButtonTitles: @\"OK\", nil];\r\n        [alertView show];\r\n}`\r\n\r\n**Remember, to use the iOS PPy library you only have to import PPyController and SecureUDID from the library folder**\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}